name: Int Tests

on:
  push

jobs:
  int-test-basic-schema:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          path: actions-nowsecure
      - name: Use Node.js 12.x
        uses: actions/setup-node@v1
        with:
          node-version: 12.x
      - name: Exporting ID Schema
        run: export ID=basic
      - name: Execute Nowsecure action
        id: nowsecure_action
        uses: ./actions-nowsecure/
        with:
          PLATFORMS: 'ios,android'
          NOWSECURE_ACCESS_TOKEN: ${{ secrets.NOWSECURE_ACCESS_TOKEN }}
          IOS_PACKAGE: 'co.uk.camelot'
          ANDROID_PACKAGE: 'uk.co.theofficialnationallotteryapp.android.play'
          NOWSECURE_GROUP_ID: ${{ secrets.UK_NOWSECURE_GROUP_ID }}
          SEVERITY_LIST: 'high,medium,low'
      - name: Integration Test Basic Schema
        uses: ./actions-nowsecure/.github/actions/schema-validator
        with:
          MACHINEUSER_GITHUB_TOKEN: ${{ secrets.MACHINEUSER_GITHUB_TOKEN }}
          INPUT_DATA: ${{ steps.nowsecure_action.outputs.nowsecureReportData }}

  int-test-extra-fields-schema:
   runs-on: ubuntu-latest
   steps:
     - name: Checkout
       uses: actions/checkout@v2
       with:
         path: actions-nowsecure
     - name: Use Node.js 12.x
       uses: actions/setup-node@v1
       with:
         node-version: 12.x
     - name: Exporting ID Schema
       id: ID
       run: export ID=extra
     - name: Execute Nowsecure action
       id: nowsecure_action
       uses: ./actions-nowsecure/
       with:
         PLATFORMS: 'ios,android'
         NOWSECURE_ACCESS_TOKEN: ${{ secrets.NOWSECURE_ACCESS_TOKEN }}
         REPORT_FIELDS: 'kind,category'
         IOS_PACKAGE: 'co.uk.camelot'
         ANDROID_PACKAGE: 'uk.co.theofficialnationallotteryapp.android.play'
         NOWSECURE_GROUP_ID: ${{ secrets.UK_NOWSECURE_GROUP_ID }}
         SEVERITY_LIST: 'high,medium,low'
     - name: Integration Test Basic Schema
       uses: ./actions-nowsecure/.github/actions/schema-validator
       with:
         MACHINEUSER_GITHUB_TOKEN: ${{ secrets.MACHINEUSER_GITHUB_TOKEN }}
         INPUT_DATA: ${{ steps.nowsecure_action.outputs.nowsecureReportData }}

